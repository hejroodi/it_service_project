{% extends 'tickets/dashboard_base.html' %}
{% block title %}Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ± IT{% endblock %}
{% block content %}
{{ block.super }}
<!-- Ù…Ø­ØªÙˆØ§ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù…Ø¯ÛŒØ± -->
<a href="{% url 'manager_reports' %}" class="btn btn-info mb-3">ðŸ“Š Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§</a>

<div id="tickets-table" class="card p-3 shadow-sm">
    {% include 'tickets/_manager_table.html' %}
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    if (Notification.permission !== "granted") {
        Notification.requestPermission();
    }
});
function refreshManagerTable(){
    fetch("{% url 'manager_dashboard_table' %}")
    .then(response => response.json())
    .then(data => {
        document.getElementById("tickets-table").innerHTML = data.html;
    });
}
setInterval(refreshManagerTable, 60000);
function checkForNewManagerTickets() {
    fetch("{% url 'check_new_tickets' %}")
    .then(response => response.json())
    .then(data => {
        if (data.new_tickets > 0 && Notification.permission === "granted") {
            new Notification("ðŸ“¢ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¬Ø¯ÛŒØ¯", {
                body: `ØªØ¹Ø¯Ø§Ø¯ ${data.new_tickets} Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¬Ø¯ÛŒØ¯ Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø§Ø³Øª.`,
                icon: "/static/images/alert-icon.png",
                requireInteraction: true
            });
        }
    });
}
setInterval(checkForNewManagerTickets, 60000);
</script>
{% endblock %}