{% extends 'tickets/dashboard_base.html' %}
{% block title %}Ù¾Ù†Ù„ Ú©Ø§Ø±Ø¨Ø±{% endblock %}
{% block content %}
{{ block.super }}



<!-- ğŸ”¸ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ -->
<div class="mt-3 mb-4 text-center">
    <a href="{% url 'new_request' %}" class="btn btn-success btn-lg">Ø«Ø¨Øª Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¬Ø¯ÛŒØ¯</a>

    {% if not outgoing_wait %}
        <a href="{% url 'send_file' %}" class="btn btn-info btn-lg">Ø§Ø±Ø³Ø§Ù„ ÙØ§ÛŒÙ„</a>
    {% else %}
        <button class="btn btn-info btn-lg" disabled>Ø§Ø±Ø³Ø§Ù„ ÙØ§ÛŒÙ„</button>
    {% endif %}

    {% if incoming_file %}
        <a href="{% url 'receive_file' %}" class="btn btn-warning btn-lg">Ø¯Ø±ÛŒØ§ÙØª ÙØ§ÛŒÙ„</a>
    {% else %}
        <button class="btn btn-warning btn-lg" disabled>Ø¯Ø±ÛŒØ§ÙØª ÙØ§ÛŒÙ„</button>
    {% endif %}
</div>

<!-- ğŸ”¸ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„ -->
<div class="card p-3 shadow-sm mt-4">
    <h5 class="fw-bold mb-3">ğŸ“Œ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„</h5>
    <div id="active-tickets-table">
        {% include 'tickets/_user_table_active.html' with tickets=active_tickets %}
    </div>
</div>

<!-- ğŸ”¸ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ ØªÙ…Ø§Ù…â€ŒØ´Ø¯Ù‡ -->
<div class="card p-3 shadow-sm mt-4">
    <h5 class="fw-bold mb-3 text-success">âœ… Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ ØªÙ…Ø§Ù…â€ŒØ´Ø¯Ù‡</h5>
    <div id="done-tickets-table">
        {% include 'tickets/_user_table_done.html' with tickets=done_tickets %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function refreshUserTables(){
    fetch("{% url 'user_dashboard_table' %}")
    .then(response => {
        if (!response.ok) {
            console.error("AJAX error:", response.status);
            return;
        }
        return response.json();
    })
    .then(data => {
        if (!data) return;
        if (data.html_active) {
            document.getElementById("active-tickets-table").innerHTML = data.html_active;
        }
        if (data.html_done) {
            document.getElementById("done-tickets-table").innerHTML = data.html_done;
        }
    })
    .catch(err => {
        console.error("Fetch exception:", err);
    });
}
// ØªÙ†Ø¸ÛŒÙ… Ø±ÙØ±Ø´ Ù‡Ø± 60 Ø«Ø§Ù†ÛŒÙ‡
setInterval(refreshUserTables, 60000);
</script>
{% endblock %}