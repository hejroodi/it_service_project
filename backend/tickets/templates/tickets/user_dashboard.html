{% extends 'tickets/dashboard_base.html' %}
{% block title %}Ù¾Ù†Ù„ Ú©Ø§Ø±Ø¨Ø±{% endblock %}
{% block content %}



{{ block.super }}

<!-- ğŸ”¹ Ø´Ù†Ø§Ø³Ù†Ø§Ù…Ù‡ IT - Ø³Ø®Øªâ€ŒØ§ÙØ²Ø§Ø± -->
<div class="mt-3 mb-4">
    <button class="btn btn-outline-primary btn-sm" type="button"
            data-bs-toggle="collapse" data-bs-target="#hardwareList"
            aria-expanded="false" aria-controls="hardwareList">
        + Ø§Ù…ÙˆØ§Ù„ IT Ø¯Ø± Ø§Ø®ØªÛŒØ§Ø±
    </button>
    <div class="collapse mt-2" id="hardwareList">
        <table class="table table-sm table-bordered mt-2">
            <thead>
                <tr>
                    <th>Ø±Ø¯ÛŒÙ</th>
                    <th>Ø¹Ù†ÙˆØ§Ù† Ø³Ø®Øªâ€ŒØ§ÙØ²Ø§Ø±</th>
                    <th>Ù…Ø¯Ù„</th>
                    <th>Ø¨Ø±Ù†Ø¯</th>
                    <th>Ø´Ù…Ø§Ø±Ù‡ Ø§Ù…ÙˆØ§Ù„</th>
                </tr>
            </thead>
            <tbody>
                {% for hw in hardwares %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ hw.title }}</td>
                    <td>{{ hw.model|default:"-" }}</td>
                    <td>{{ hw.brand|default:"-" }}</td>
                    <td>{% if hw.asset_number %}{{ hw.asset_number }}{% else %}Ù†Ø¯Ø§Ø±Ø¯{% endif %}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="text-center">Ù‡ÛŒÚ† Ø³Ø®Øªâ€ŒØ§ÙØ²Ø§Ø±ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- ğŸ”¹ Ø´Ù†Ø§Ø³Ù†Ø§Ù…Ù‡ IT - Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± -->
<div class="mt-3 mb-4">
    <button class="btn btn-outline-success btn-sm" type="button"
            data-bs-toggle="collapse" data-bs-target="#softwareList"
            aria-expanded="false" aria-controls="softwareList">
        + Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù†ØµØ¨â€ŒØ´Ø¯Ù‡
    </button>
    <div class="collapse mt-2" id="softwareList">
        <table class="table table-sm table-bordered mt-2">
            <thead>
                <tr>
                    <th>Ø±Ø¯ÛŒÙ</th>
                    <th>Ø¹Ù†ÙˆØ§Ù† Ø¨Ø±Ù†Ø§Ù…Ù‡</th>
                    <th>Ù†Ø³Ø®Ù‡</th>
                    <th>Ø³Ø§Ø²Ù†Ø¯Ù‡</th>
                </tr>
            </thead>
            <tbody>
                {% for sw in softwares %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ sw.title }}</td>
                    <td>{{ sw.version|default:"-" }}</td>
                    <td>{{ sw.vendor|default:"-" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="text-center">Ù‡ÛŒÚ† Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>


<!-- ğŸ”¸ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ -->
<div class="mt-3 mb-4 text-center">
    <a href="{% url 'new_request' %}" class="btn btn-success btn-lg">Ø«Ø¨Øª Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¬Ø¯ÛŒØ¯</a>

    {% if not outgoing_wait %}
        <a href="{% url 'send_file' %}" class="btn btn-info btn-lg">Ø§Ø±Ø³Ø§Ù„ ÙØ§ÛŒÙ„</a>
    {% else %}
        <button class="btn btn-info btn-lg" disabled>Ø§Ø±Ø³Ø§Ù„ ÙØ§ÛŒÙ„</button>
    {% endif %}

    {% if incoming_file %}
        <a href="{% url 'receive_file' %}" class="btn btn-warning btn-lg">Ø¯Ø±ÛŒØ§ÙØª ÙØ§ÛŒÙ„</a>
    {% else %}
        <button class="btn btn-warning btn-lg" disabled>Ø¯Ø±ÛŒØ§ÙØª ÙØ§ÛŒÙ„</button>
    {% endif %}
</div>

<!-- ğŸ”¸ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„ -->
<div class="card p-3 shadow-sm mt-4">
    <h5 class="fw-bold mb-3">ğŸ“Œ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„</h5>
    <div id="active-tickets-table">
        {% include 'tickets/_user_table_active.html' with tickets=active_tickets %}
    </div>
</div>

<!-- ğŸ”¸ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ ØªÙ…Ø§Ù…â€ŒØ´Ø¯Ù‡ -->
<div class="card p-3 shadow-sm mt-4">
    <h5 class="fw-bold mb-3 text-success">âœ… Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ ØªÙ…Ø§Ù…â€ŒØ´Ø¯Ù‡</h5>
    <div id="done-tickets-table">
        {% include 'tickets/_user_table_done.html' with tickets=done_tickets %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function refreshUserTables(){
    fetch("{% url 'user_dashboard_table' %}")
    .then(response => {
        if (!response.ok) {
            console.error("AJAX error:", response.status);
            return;
        }
        return response.json();
    })
    .then(data => {
        if (!data) return;
        if (data.html_active) {
            document.getElementById("active-tickets-table").innerHTML = data.html_active;
        }
        if (data.html_done) {
            document.getElementById("done-tickets-table").innerHTML = data.html_done;
        }
    })
    .catch(err => {
        console.error("Fetch exception:", err);
    });
}
// ØªÙ†Ø¸ÛŒÙ… Ø±ÙØ±Ø´ Ù‡Ø± 60 Ø«Ø§Ù†ÛŒÙ‡
setInterval(refreshUserTables, 60000);
</script>
{% endblock %}