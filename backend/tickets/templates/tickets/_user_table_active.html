<table class="table table-striped table-bordered">
    <thead>
        <tr>
            <th>Ø¹Ù†ÙˆØ§Ù† Ø¯Ø±Ø®ÙˆØ§Ø³Øª</th>
            <th>ØªÙˆØ¶ÛŒØ­Ø§Øª</th>
            <th>ÙˆØ§Ø­Ø¯</th>
            <th>Ù†ÙˆØ¹ Ø®Ø¯Ù…Øª</th>
            <th>ÙˆØ¶Ø¹ÛŒØª</th>
            <th>Ø¯Ø± Ú©Ø§Ø±ØªØ§Ø¨Ù„ Ú†Ù‡ Ú©Ø³ÛŒ</th>
            <th>Ù‚Ø¨Ù„ Ø§Ø² Ù…Ù† Ú†Ù†Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø§Ø³Øª</th>
            <th>Ø§Ù‚Ø¯Ø§Ù…</th>
        </tr>
    </thead>
    <tbody>
    {% for t in tickets %}
    <tr>
        <!-- Ø¹Ù†ÙˆØ§Ù† -->
        <td style="{% if t.status == 'done' %}background-color: rgba(40,167,69,0.15);
                    {% elif t.status == 'in_progress' %}background-color: rgba(220,53,69,0.15);
                    {% else %}background-color: rgba(23,162,184,0.15);{% endif %}">
            {{ t.title }}
        </td>

        <!-- ØªÙˆØ¶ÛŒØ­Ø§Øª -->
        <td style="{% if t.status == 'done' %}background-color: rgba(40,167,69,0.15);
                    {% elif t.status == 'in_progress' %}background-color: rgba(220,53,69,0.15);
                    {% else %}background-color: rgba(23,162,184,0.15);{% endif %}">
            {{ t.description }}
        </td>

        <!-- ÙˆØ§Ø­Ø¯ -->
        <td style="{% if t.status == 'done' %}background-color: rgba(40,167,69,0.15);
                    {% elif t.status == 'in_progress' %}background-color: rgba(220,53,69,0.15);
                    {% else %}background-color: rgba(23,162,184,0.15);{% endif %}">
            {{ t.unit.name }}
        </td>

        <!-- Ù†ÙˆØ¹ Ø®Ø¯Ù…Øª -->
        <td style="{% if t.status == 'done' %}background-color: rgba(40,167,69,0.15);
                    {% elif t.status == 'in_progress' %}background-color: rgba(220,53,69,0.15);
                    {% else %}background-color: rgba(23,162,184,0.15);{% endif %}">
            {{ t.service_type.name }}
        </td>

        <!-- ÙˆØ¶Ø¹ÛŒØª -->
        <td style="{% if t.status == 'done' %}background-color: rgba(40,167,69,0.15);
                    {% elif t.status == 'in_progress' %}background-color: rgba(220,53,69,0.15);
                    {% else %}background-color: rgba(23,162,184,0.15);{% endif %}">
            {{ t.get_status_display }}
        </td>

        <!-- Ø¯Ø± Ú©Ø§Ø±ØªØ§Ø¨Ù„ Ú†Ù‡ Ú©Ø³ÛŒ -->
        <td style="{% if t.status == 'done' %}background-color: rgba(40,167,69,0.15);
                    {% elif t.status == 'in_progress' %}background-color: rgba(220,53,69,0.15);
                    {% else %}background-color: rgba(23,162,184,0.15);{% endif %}">
            {% if t.assigned_to %}
                {{ t.assigned_to.get_full_name }}
                <br>
                <small>ğŸ“ {{ t.assigned_to.phone_number|default:"-" }}</small>
                <br>
                <small>ğŸ¢ Ø§ØªØ§Ù‚: {{ t.assigned_to.room_number|default:"-" }}</small>
            {% else %}
                Ù…Ø¯ÛŒØ± ÙÙ†Ø§ÙˆØ±ÛŒ  
                {% with manager=managers.0 %}
                    <br>
                    <small>ğŸ“ {{ manager.phone_number|default:"-" }}</small>
                    <br>
                    <small>ğŸ¢ Ø§ØªØ§Ù‚: {{ manager.room_number|default:"-" }}</small>
                {% endwith %}
            {% endif %}
        </td>

        <!-- Ù‚Ø¨Ù„ Ø§Ø² Ù…Ù† Ú†Ù†Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø§Ø³Øª -->
        <td style="{% if t.status == 'done' %}background-color: rgba(40,167,69,0.15);
                    {% elif t.status == 'in_progress' %}background-color: rgba(220,53,69,0.15);
                    {% else %}background-color: rgba(23,162,184,0.15);{% endif %}">
            {% if t.before_count is not None %}
                {{ t.before_count }}
            {% else %}
                -
            {% endif %}
        </td>

        <!-- Ø§Ù‚Ø¯Ø§Ù… -->
        <td style="{% if t.status == 'done' %}background-color: rgba(40,167,69,0.15);
                    {% elif t.status == 'in_progress' %}background-color: rgba(220,53,69,0.15);
                    {% else %}background-color: rgba(23,162,184,0.15);{% endif %}">
            {% if t.status == 'new' and not t.assigned_to %}
                <a href="{% url 'edit_request' t.id %}" class="text-warning fw-bold me-2" style="text-decoration:none;">
                    ÙˆÛŒØ±Ø§ÛŒØ´
                </a>
                <a href="{% url 'delete_request' t.id %}" class="text-danger fw-bold me-2" style="text-decoration:none;"
                   onclick="return confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')">
                    Ø­Ø°Ù
                </a>
            {% endif %}

            {% if t.has_unread %}
                <a href="{% url 'ticket_messages' t.id %}" class="btn btn-sm btn-outline-info blink">Ù¾ÛŒØ§Ù… Ø¬Ø¯ÛŒØ¯</a>
            {% else %}
                <a href="{% url 'ticket_messages' t.id %}" class="btn btn-sm btn-outline-info">Ú¯ÙØªÚ¯Ùˆ</a>
            {% endif %}
        </td>
    </tr>
    {% empty %}
    <tr>
        <td colspan="8" class="text-center">Ù‡ÛŒÚ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</td>
    </tr>
    {% endfor %}
    </tbody>
</table>