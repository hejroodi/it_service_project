{% extends 'tickets/base.html' %}
{% load custom_tags %}

{% block content %}
<!-- Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card p-3 shadow-sm bg-light">
            <h4 class="fw-bold mb-0">ğŸ‘‹ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ {{ user.username }}</h4>
            <p class="text-muted">Ø§ÛŒÙ† Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø®ØµÙˆØµ Ø´Ù…Ø§Ø³Øª.</p>
        </div>
    </div>
</div>

<!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±ÛŒ Ùˆ Ø¯Ú©Ù…Ù‡ Ù…Ø®ØµÙˆØµ -->
{% if user.is_authenticated %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card p-3 shadow-sm">
            <h5 class="fw-bold mb-3">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±ÛŒ</h5>
            <p><strong>Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ:</strong> {{ user.get_full_name }}</p>
            {% if user.unit %}
                <p><strong>ÙˆØ§Ø­Ø¯:</strong> {{ user.unit.name }}</p>
            {% endif %}

            {% if user|has_group:"User" %}
                <a href="{% url 'new_request' %}" class="btn btn-primary mt-3">+ Ø«Ø¨Øª Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¬Ø¯ÛŒØ¯</a>
            {% endif %}

            {% if user|has_group:"Manager" %}
                <a href="{% url 'manager_reports' %}" class="btn btn-info mt-3">ğŸ“Š Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§</a>
            {% endif %}

            {% if user|has_group:"Expert" %}
                <a href="#" onclick="askNotificationPermission()" class="btn btn-warning mt-3">ğŸ”” ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†</a>
            {% endif %}
        </div>
    </div>
</div>
{% endif %}

<!-- Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø± -->
<div class="row g-3">
    <div class="col-md-4">
        <div class="card text-center p-3 shadow-sm">
            <h5 class="fw-bold">Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²</h5>
            <p class="fs-3 text-primary">{{ open_requests }}</p>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-center p-3 shadow-sm">
            <h5 class="fw-bold">Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ ØªÚ©Ù…ÛŒÙ„â€ŒØ´Ø¯Ù‡</h5>
            <p class="fs-3 text-success">{{ closed_requests }}</p>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-center p-3 shadow-sm">
            <h5 class="fw-bold">Ú©Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§</h5>
            <p class="fs-3 text-secondary">{{ total_requests }}</p>
        </div>
    </div>
</div>

<!-- Ø¬Ø¯ÙˆÙ„ Ø¢Ø®Ø±ÛŒÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card p-3 shadow-sm">
            <h5 class="fw-bold mb-3">Ø¢Ø®Ø±ÛŒÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ (Ø§Ø±Ø¬Ø§Ø¹â€ŒÙ†Ø´Ø¯Ù‡)</h5>

            {% if latest_requests %}
                {% if user|has_group:"User" %}
                    {% include 'tickets/_user_table.html' with tickets=latest_requests %}
                {% elif user|has_group:"Manager" %}
                    {% include 'tickets/_manager_table.html' with tickets=latest_requests %}
                {% elif user|has_group:"Expert" %}
                    {% include 'tickets/_expert_table.html' with tickets=latest_requests %}
                {% endif %}
            {% else %}
                <p class="text-muted">Ù‡ÛŒÚ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¬Ø¯ÛŒØ¯ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}