{% extends 'tickets/base.html' %}
{% block title %}گفتگو درباره درخواست{% endblock %}

{% block content %}
<h3 class="mb-3">درخواست: {{ ticket.title }}</h3>

<!-- لیست پیام‌ها -->
<div class="mb-3">
    {% for msg in messages %}
        <div class="p-2 mb-2 border rounded 
             {% if msg.sender == request.user %}bg-light{% else %}bg-white{% endif %}">
            <strong>{{ msg.sender.get_full_name }}:</strong>
            <p class="mb-1">{{ msg.message|linebreaks }}</p>
            <small class="text-muted">{{ msg.created_at|date:"Y-m-d H:i" }}</small>
        </div>
    {% empty %}
        <p class="text-muted">هنوز پیامی ثبت نشده است.</p>
    {% endfor %}
</div>

<hr>

<!-- فرم ارسال پیام -->
<form method="post" class="mt-3">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit" class="btn btn-primary">ارسال پیام</button>
    <a href="{% if request.user == ticket.requester %}{% url 'user_dashboard' %}
             {% elif request.user == ticket.assigned_to %}{% url 'expert_dashboard' %}
             {% else %}{% url 'role_redirect' %}{% endif %}"
       class="btn btn-secondary ms-2">بازگشت</a>
</form>
{% endblock %}